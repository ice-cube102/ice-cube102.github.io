<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로봇이 아닌지 확인</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            text-align: center;
        }
        .container {
            background-color: #fff;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 100%;
        }
        .message-box {
            display: none;
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
        }
        .success {
            background-color: #d1fae5;
            color: #065f46;
        }
        .error {
            background-color: #fee2e2;
            color: #991b1b;
        }
        canvas {
            border: 2px solid #e5e7eb;
            background-color: #f9fafb;
            border-radius: 0.5rem;
            width: 100%;
            height: 100px;
        }
        .daily-code-box {
            display: none;
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 0.5rem;
            font-weight: bold;
            background-color: #e0f2fe;
            color: #0369a1;
            border: 2px dashed #38bdf8;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1 class="text-3xl font-bold mb-4 text-gray-800">로봇이 아닌지 확인해야합니다</h1>
        
        <!-- 문자 CAPTCHA -->
        <div id="textCaptchaContainer">
            <p id="captchaPrompt" class="text-gray-600 mb-6">아래 이미지의 문자를 대소문자 구별하여 입력하세요.</p>
            <canvas id="captchaCanvas"></canvas>
            <div class="my-4">
                <input type="text" id="userInput" class="w-full px-4 py-3 text-lg font-mono border-2 border-gray-300 rounded-lg text-gray-800 focus:outline-none focus:border-blue-500" placeholder="여기에 입력하세요...">
            </div>
            <button id="checkBtn" class="w-full bg-green-500 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition duration-300 ease-in-out">
                확인
            </button>
        </div>
        
        <div id="messageBox" class="message-box"></div>
        <div id="dailyCodeBox" class="daily-code-box"></div>
    </div>

    <script>
        const captchaCanvas = document.getElementById('captchaCanvas');
        const ctx = captchaCanvas.getContext('2d');
        const userInput = document.getElementById('userInput');
        const checkBtn = document.getElementById('checkBtn');
        const messageBox = document.getElementById('messageBox');
        const dailyCodeBox = document.getElementById('dailyCodeBox');
        const captchaPrompt = document.getElementById('captchaPrompt');
        
        let captchaText = '';
        
        // 헷갈리는 문자를 제외한 무작위 문자열을 생성하는 함수
        function generateRandomString(length) {
            const characters = 'ABCDEFGHJKMNPQRTUYabcdefghjkmnpqrtuy23456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return result;
        }

        // CAPTCHA를 캔버스에 그리는 함수
        function drawCaptcha(text) {
            captchaText = text;
            ctx.clearRect(0, 0, captchaCanvas.width, captchaCanvas.height);
            
            ctx.fillStyle = '#f9fafb';
            ctx.fillRect(0, 0, captchaCanvas.width, captchaCanvas.height);

            ctx.font = 'bold 30px Inter';
            let x = 10;
            const y = captchaCanvas.height / 2 + 10;

            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate((Math.random() - 0.5) * 0.5);
                ctx.fillStyle = `rgb(${Math.floor(Math.random() * 200)}, ${Math.floor(Math.random() * 200)}, ${Math.floor(Math.random() * 200)})`;
                ctx.font = `bold ${30 + Math.floor(Math.random() * 10)}px Inter`;
                ctx.fillText(char, 0, 0);
                ctx.restore();
                x += 30 + Math.floor(Math.random() * 5);
            }

            for (let i = 0; i < 3; i++) {
                ctx.beginPath();
                ctx.moveTo(Math.random() * captchaCanvas.width, Math.random() * captchaCanvas.height);
                ctx.lineTo(Math.random() * captchaCanvas.width, Math.random() * captchaCanvas.height);
                ctx.strokeStyle = `rgb(${Math.floor(Math.random() * 150)}, ${Math.floor(Math.random() * 150)}, ${Math.floor(Math.random() * 150)})`;
                ctx.stroke();
            }
        }
        
        // 메시지 박스를 표시하는 함수
        function showMessage(message, type) {
            messageBox.textContent = message;
            messageBox.className = `message-box ${type} block`;
        }

        // 오늘의 코드를 계산하고 표시하는 함수
        function showDailyCode() {
            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth() + 1;
            const day = today.getDate();
            const dailyCode = year * month * day;
            dailyCodeBox.textContent = `오늘의 코드: ${dailyCode}`;
            dailyCodeBox.style.display = 'block';
        }

        // 입력된 문자를 확인하고 다음 단계로 진행하는 함수
        function checkInputAndProceed() {
            const trimmedInput = userInput.value.trim();

            if (trimmedInput === captchaText) {
                showMessage('확인 완료: 당신은 사람입니다!', 'success');
                showDailyCode();
            } else {
                showMessage('오류: 문자가 일치하지 않습니다. 다시 시도하세요.', 'error');
                refreshCaptcha();
            }
        }

        // 문자 캡차 새로고침 함수
        function refreshCaptcha() {
            const newText = generateRandomString(6);
            drawCaptcha(newText);
            userInput.value = '';
            messageBox.style.display = 'none';
            dailyCodeBox.style.display = 'none';
            captchaPrompt.textContent = `아래 이미지의 문자를 대소문자 구별하여 입력하세요.`;
            userInput.focus();
        }

        // 이벤트 리스너
        checkBtn.addEventListener('click', checkInputAndProceed);
        userInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                checkInputAndProceed();
            }
        });

        // 페이지 로드 시 첫 캡차 생성
        window.onload = function() {
            captchaCanvas.width = captchaCanvas.offsetWidth;
            captchaCanvas.height = captchaCanvas.offsetHeight;
            refreshCaptcha();
        };
    </script>

</body>
</html>
