<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>코드 뽑기 게임</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes sparkle {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 0.8; }
        }
        @keyframes winner {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(-10px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-10px); }
        }
        .sparkle { animation: sparkle 0.6s ease-in-out; }
        .winner { animation: winner 0.5s ease-in-out 3; }
        .pendant-message { animation: fadeInOut 3s ease-in-out forwards; }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .golden-btn {
            background: linear-gradient(45deg, #fce6a8, #f5c242); box-shadow: 0 4px 15px rgba(245, 194, 66, 0.5);
        }
        .rainbow-btn {
            background: linear-gradient(120deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888, #9c27b0, #734bde, #42a5f5, #26c6da, #26a69a, #4caf50); background-size: 200% 200%;
            animation: rainbow-animation 2s ease infinite;
        }
        @keyframes rainbow-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .rainbow-text {
            background: linear-gradient(120deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888, #9c27b0, #734bde, #42a5f5, #26c6da, #26a69a, #4caf50); -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 200% 200%;
            animation: rainbow-animation 2s ease infinite; }
        .info-tooltip-container {
            position: absolute; top: 4px;
            right: 4px;
            display: inline-block;
        }
        .info-tooltip-icon {
            cursor: pointer; color: #9ca3af;
        }
        .info-tooltip-content {
            visibility: hidden; width: 250px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%; margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .info-tooltip-content::after {
            content: ""; position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent; }
        .info-tooltip-container:hover .info-tooltip-content {
            visibility: visible; opacity: 1;
        }
        .coin-popup {
            position: absolute; font-weight: bold;
            font-size: 1.25rem;
            color: #ffb700;
            animation: coin-fade-up 1s forwards;
            pointer-events: none; }
        @keyframes coin-fade-up {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-50px); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-4">
    <!-- Google AdSense 코드 -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8681578396964496" crossorigin="anonymous"></script>

    <div class="absolute top-0 left-0 w-full bg-white/20 backdrop-blur-sm shadow-md py-1">
        <div class="max-w-md mx-auto px-4">
            <div class="w-full bg-gray-200 rounded-full h-2">
                <div id="mainProgressBar" class="bg-gradient-to-r from-pink-500 to-purple-600 h-2 rounded-full transition-all duration-100"></div>
            </div>
        </div>
    </div>
    
    <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full relative pt-16">
        <!-- 신속의 팬던트 메시지 -->
        <div id="pendantMessage" class="absolute top-16 left-1/2 -translate-x-1/2 bg-yellow-400 text-yellow-900 font-bold py-2 px-6 rounded-full shadow-lg hidden">
            ✨ 신속의 팬던트 잠금 해제!
        </div>

        <!-- 플레이타임 -->
        <div class="absolute top-4 right-4 bg-gray-100 rounded-full px-4 py-2 text-center text-xs shadow-md">
            <p class="text-gray-600 mb-0.5">⏱️ 플레이타임</p>
            <p class="font-bold text-gray-800" id="playTime">0분 0초</p>
        </div>

        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">
                🎰 오늘의 코드 뽑기
            </h1>
            <div class="bg-yellow-100 rounded-lg p-3 mb-4" id="codeDisplay">
                <p class="text-sm text-gray-600 mb-1">🎯 획득한 코드</p>
                <p class="text-2xl font-mono font-bold text-green-700" id="currentProgress">?????</p>
                <p class="text-xs text-gray-500 mt-1">당첨으로 한 자리씩 공개해보세요!</p>
            </div>
        </div>

        <!-- 통계 표시 -->
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6 relative">
            <div id="coinsPopupContainer" class="absolute top-0 left-1/2 -translate-x-1/2"></div>
            <div class="bg-blue-50 rounded-lg p-3 text-center">
                <p class="text-xs text-blue-600 mb-1">확률</p>
                <p class="text-lg font-bold text-blue-800" id="currentChance">0.010%</p>
            </div>
            <div class="bg-purple-50 rounded-lg p-3 text-center">
                <p class="text-xs text-purple-600 mb-1">뽑은 횟수</p>
                <p class="text-lg font-bold text-purple-800" id="drawCount">0</p>
            </div>
            <div class="bg-green-50 rounded-lg p-3 text-center">
                <p class="text-xs text-green-600 mb-1">쿨타임</p>
                <p class="text-lg font-bold text-green-800" id="cooldownTime">3.00초</p>
            </div>
            <div class="bg-yellow-50 rounded-lg p-3 text-center">
                <p class="text-xs text-yellow-600 mb-1">코인</p>
                <p class="text-lg font-bold text-yellow-800" id="totalCoins">0</p>
            </div>
        </div>
        
        <!-- 뽑기 버튼 -->
        <div class="text-center mb-6">
            <button id="drawButton" class="bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-full text-xl shadow-lg transform transition-all duration-200 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
                🎲 뽑기!
            </button>
            <p class="text-sm text-gray-500 mt-2" id="buttonStatus"></p>
        </div>

        <!-- 결과 표시 -->
        <div id="resultArea" class="text-center min-h-[100px] flex items-center justify-center">
        </div>
        
        <!-- 전체 기계 제어 버튼 -->
        <div class="flex justify-center mb-6">
            <button id="toggleAllAutoMachines" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-full text-sm">자동 기계 숨기기</button>
        </div>

        <!-- 자동 뽑기 기계 섹션 -->
        <div id="autoMachinesContainer">
            <div id="autoMachine1Wrapper" class="hidden mb-6 border-2 border-orange-200 rounded-xl">
                <div class="flex items-center justify-between p-4 bg-orange-100 rounded-t-xl border-b border-orange-200 relative">
                    <div class="flex items-center">
                        <span class="text-2xl mr-2">🤖</span>
                        <div>
                            <h3 class="text-lg font-bold text-orange-800">자동 뽑기 기계 1</h3>
                            <p class="text-xs text-orange-600">레벨: <span id="autoLevel1">1</span> | 뽑은 횟수: <span id="autoDrawCount1">0</span></p>
                        </div>
                    </div>
                    <div class="info-tooltip-container">
                        <span class="info-tooltip-icon">ⓘ</span>
                        <div class="info-tooltip-content">
                            <p class="font-bold text-sm mb-1">자동 뽑기 기계 1</p>
                            <ul class="list-disc list-inside text-xs space-y-1">
                                <li><strong>획득 조건:</strong> 뽑은 횟수 10회 달성</li>
                                <li><strong>기능:</strong> 자동으로 뽑기를 시도하고 코인을 획득합니다.</li>
                                <li><strong>쿨타임:</strong> 일반 뽑기 쿨타임의 3배</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div id="autoMachine1Content" class="bg-gradient-to-r from-orange-100 to-red-100 rounded-b-xl p-4">
                    <div class="bg-white rounded-lg p-3">
                        <div id="auto1ProgressContainer">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">상태:</span>
                                <span class="text-sm font-medium" id="autoStatus1">대기중...</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div class="bg-orange-500 h-2 rounded-full transition-all duration-100" id="autoProgress1" style="width: 0%"></div>
                            </div>
                            <p class="text-xs text-blue-600 mt-2 text-right">확률: <span id="autoChance1">0.010%</span></p>
                        </div>
                    </div>
                    <div class="flex justify-center mt-4 space-x-2 flex-wrap">
                        <button id="levelUpAuto1" class="bg-green-500 text-white text-xs py-2 px-4 rounded-full hover:bg-green-600 transition-colors disabled:opacity-50">레벨업 (10 코인)</button>
                        <button id="unlockGolden1" class="hidden bg-yellow-500 text-yellow-900 text-xs py-2 px-4 rounded-full hover:bg-yellow-600 transition-colors disabled:opacity-50">황금 뽑기 잠금 해제 (500 코인)</button>
                        <button id="unlockRainbow1" class="hidden bg-purple-500 text-white text-xs py-2 px-4 rounded-full hover:bg-purple-600 transition-colors disabled:opacity-50">무지개 뽑기 잠금 해제 (1000 코인)</button>
                    </div>
                </div>
            </div>
            
            <div id="autoMachine2Wrapper" class="hidden mb-6 border-2 border-purple-200 rounded-xl">
                <div class="flex items-center justify-between p-4 bg-purple-100 rounded-t-xl border-b border-purple-200 relative">
                    <div class="flex items-center">
                        <span class="text-2xl mr-2">🤖</span>
                        <div>
                            <h3 class="text-lg font-bold text-indigo-800">자동 뽑기 기계 2</h3>
                            <p class="text-xs text-indigo-600">레벨: <span id="autoLevel2">1</span> | 뽑은 횟수: <span id="autoDrawCount2">0</span></p>
                        </div>
                    </div>
                    <div class="info-tooltip-container">
                        <span class="info-tooltip-icon">ⓘ</span>
                        <div class="info-tooltip-content">
                            <p class="font-bold text-sm mb-1">자동 뽑기 기계 2</p>
                            <ul class="list-disc list-inside text-xs space-y-1">
                                <li><strong>획득 조건:</strong> 자동 기계 1의 뽑은 횟수 20회 달성</li>
                                <li><strong>기능:</strong> 자동으로 뽑기를 시도하고 코인을 획득합니다.</li>
                                <li><strong>쿨타임:</strong> 일반 뽑기 쿨타임의 2.5배</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div id="autoMachine2Content" class="bg-gradient-to-r from-purple-100 to-indigo-100 rounded-b-xl p-4">
                    <div class="bg-white rounded-lg p-3">
                        <div id="auto2ProgressContainer">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">상태:</span>
                                <span class="text-sm font-medium" id="autoStatus2">대기중...</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div class="bg-indigo-500 h-2 rounded-full transition-all duration-100" id="autoProgress2" style="width: 0%"></div>
                            </div>
                            <p class="text-xs text-blue-600 mt-2 text-right">확률: <span id="autoChance2">0.010%</span></p>
                        </div>
                    </div>
                    <div class="flex justify-center mt-4 space-x-2 flex-wrap">
                        <button id="levelUpAuto2" class="bg-green-500 text-white text-xs py-2 px-4 rounded-full hover:bg-green-600 transition-colors disabled:opacity-50">레벨업 (10 코인)</button>
                        <button id="unlockGolden2" class="hidden bg-yellow-500 text-yellow-900 text-xs py-2 px-4 rounded-full hover:bg-yellow-600 transition-colors disabled:opacity-50">황금 뽑기 잠금 해제 (500 코인)</button>
                        <button id="unlockRainbow2" class="hidden bg-purple-500 text-white text-xs py-2 px-4 rounded-full hover:bg-purple-600 transition-colors disabled:opacity-50">무지개 뽑기 잠금 해제 (1000 코인)</button>
                    </div>
                </div>
            </div>
            
            <div id="autoMachine3Wrapper" class="hidden mb-6 border-2 border-green-200 rounded-xl">
                <div class="flex items-center justify-between p-4 bg-green-100 rounded-t-xl border-b border-green-200 relative">
                    <div class="flex items-center">
                        <span class="text-2xl mr-2">🤖</span>
                        <div>
                            <h3 class="text-lg font-bold text-teal-800">자동 뽑기 기계 3</h3>
                            <p class="text-xs text-teal-600">레벨: <span id="autoLevel3">1</span> | 뽑은 횟수: <span id="autoDrawCount3">0</span></p>
                        </div>
                    </div>
                    <div class="info-tooltip-container">
                        <span class="info-tooltip-icon">ⓘ</span>
                        <div class="info-tooltip-content">
                            <p class="font-bold text-sm mb-1">자동 뽑기 기계 3</p>
                            <ul class="list-disc list-inside text-xs space-y-1">
                                <li><strong>획득 조건:</strong> 자동 기계 2의 뽑은 횟수 30회 달성</li>
                                <li><strong>기능:</strong> 자동으로 뽑기를 시도하고 코인을 획득합니다.</li>
                                <li><strong>쿨타임:</strong> 일반 뽑기 쿨타임의 2배</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div id="autoMachine3Content" class="bg-gradient-to-r from-green-100 to-teal-100 rounded-b-xl p-4">
                    <div class="bg-white rounded-lg p-3">
                        <div id="auto3ProgressContainer">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">상태:</span>
                                <span class="text-sm font-medium" id="autoStatus3">대기중...</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div class="bg-teal-500 h-2 rounded-full transition-all duration-100" id="autoProgress3" style="width: 0%"></div>
                            </div>
                            <p class="text-xs text-blue-600 mt-2 text-right">확률: <span id="autoChance3">0.010%</span></p>
                        </div>
                    </div>
                    <div class="flex justify-center mt-4 space-x-2 flex-wrap">
                        <button id="levelUpAuto3" class="bg-green-500 text-white text-xs py-2 px-4 rounded-full hover:bg-green-600 transition-colors disabled:opacity-50">레벨업 (10 코인)</button>
                        <button id="unlockGolden3" class="hidden bg-yellow-500 text-yellow-900 text-xs py-2 px-4 rounded-full hover:bg-yellow-600 transition-colors disabled:opacity-50">황금 뽑기 잠금 해제 (500 코인)</button>
                        <button id="unlockRainbow3" class="hidden bg-purple-500 text-white text-xs py-2 px-4 rounded-full hover:bg-purple-600 transition-colors disabled:opacity-50">무지개 뽑기 잠금 해제 (1000 코인)</button>
                    </div>
                </div>
            </div>
            
            <div id="autoMachine4Wrapper" class="hidden mb-6 border-2 border-sky-200 rounded-xl">
                <div class="flex items-center justify-between p-4 bg-sky-100 rounded-t-xl border-b border-sky-200 relative">
                    <div class="flex items-center">
                        <span class="text-2xl mr-2">🤖</span>
                        <div>
                            <h3 class="text-lg font-bold text-sky-800">자동 뽑기 기계 4</h3>
                            <p class="text-xs text-sky-600">레벨: <span id="autoLevel4">1</span> | 뽑은 횟수: <span id="autoDrawCount4">0</span></p>
                        </div>
                    </div>
                    <div class="info-tooltip-container">
                        <span class="info-tooltip-icon">ⓘ</span>
                        <div class="info-tooltip-content">
                            <p class="font-bold text-sm mb-1">자동 뽑기 기계 4</p>
                            <ul class="list-disc list-inside text-xs space-y-1">
                                <li><strong>획득 조건:</strong> 자동 기계 3의 뽑은 횟수 50회 달성</li>
                                <li><strong>기능:</strong> 자동으로 뽑기를 시도하고 코인을 획득합니다.</li>
                                <li><strong>쿨타임:</strong> 일반 뽑기 쿨타임의 1.8배</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div id="autoMachine4Content" class="bg-gradient-to-r from-sky-100 to-cyan-100 rounded-b-xl p-4">
                    <div class="bg-white rounded-lg p-3">
                        <div id="auto4ProgressContainer">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">상태:</span>
                                <span class="text-sm font-medium" id="autoStatus4">대기중...</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div class="bg-sky-500 h-2 rounded-full transition-all duration-100" id="autoProgress4" style="width: 0%"></div>
                            </div>
                            <p class="text-xs text-blue-600 mt-2 text-right">확률: <span id="autoChance4">0.010%</span></p>
                        </div>
                    </div>
                    <div class="flex justify-center mt-4 space-x-2 flex-wrap">
                        <button id="levelUpAuto4" class="bg-green-500 text-white text-xs py-2 px-4 rounded-full hover:bg-green-600 transition-colors disabled:opacity-50">레벨업 (10 코인)</button>
                        <button id="unlockGolden4" class="hidden bg-yellow-500 text-yellow-900 text-xs py-2 px-4 rounded-full hover:bg-yellow-600 transition-colors disabled:opacity-50">황금 뽑기 잠금 해제 (500 코인)</button>
                        <button id="unlockRainbow4" class="hidden bg-purple-500 text-white text-xs py-2 px-4 rounded-full hover:bg-purple-600 transition-colors disabled:opacity-50">무지개 뽑기 잠금 해제 (1000 코인)</button>
                    </div>
                </div>
            </div>
            
            <div id="autoMachine5Wrapper" class="hidden mb-6 border-2 border-indigo-200 rounded-xl">
                <div class="flex items-center justify-between p-4 bg-indigo-100 rounded-t-xl border-b border-indigo-200 relative">
                    <div class="flex items-center">
                        <span class="text-2xl mr-2">🤖</span>
                        <div>
                            <h3 class="text-lg font-bold text-indigo-800">자동 뽑기 기계 5</h3>
                            <p class="text-xs text-indigo-600">레벨: <span id="autoLevel5">1</span> | 뽑은 횟수: <span id="autoDrawCount5">0</span></p>
                        </div>
                    </div>
                    <div class="info-tooltip-container">
                        <span class="info-tooltip-icon">ⓘ</span>
                        <div class="info-tooltip-content">
                            <p class="font-bold text-sm mb-1">자동 뽑기 기계 5</p>
                            <ul class="list-disc list-inside text-xs space-y-1">
                                <li><strong>획득 조건:</strong> 모든 자동 기계 레벨 4 이상 & 뽑은 횟수 50회 이상</li>
                                <li><strong>기능:</strong> 자동으로 뽑기를 시도하고 코인을 획득합니다.</li>
                                <li><strong>쿨타임:</strong> 일반 뽑기 쿨타임의 1.5배</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div id="autoMachine5Content" class="bg-gradient-to-r from-indigo-100 to-blue-100 rounded-b-xl p-4">
                    <div class="bg-white rounded-lg p-3">
                        <div id="auto5ProgressContainer">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">상태:</span>
                                <span class="text-sm font-medium" id="autoStatus5">대기중...</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div class="bg-indigo-500 h-2 rounded-full transition-all duration-100" id="autoProgress5" style="width: 0%"></div>
                            </div>
                            <p class="text-xs text-blue-600 mt-2 text-right">확률: <span id="autoChance5">0.010%</span></p>
                        </div>
                    </div>
                    <div class="flex justify-center mt-4 space-x-2 flex-wrap">
                        <button id="levelUpAuto5" class="bg-green-500 text-white text-xs py-2 px-4 rounded-full hover:bg-green-600 transition-colors disabled:opacity-50">레벨업 (10 코인)</button>
                        <button id="unlockGolden5" class="hidden bg-yellow-500 text-yellow-900 text-xs py-2 px-4 rounded-full hover:bg-yellow-600 transition-colors disabled:opacity-50">황금 뽑기 잠금 해제 (500 코인)</button>
                        <button id="unlockRainbow5" class="hidden bg-purple-500 text-white text-xs py-2 px-4 rounded-full hover:bg-purple-600 transition-colors disabled:opacity-50">무지개 뽑기 잠금 해제 (1000 코인)</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 당첨 기록 -->
        <div class="mt-6">
            <h3 class="text-lg font-semibold text-gray-700 mb-3">🏆 당첨 기록</h3>
            <div id="winHistory" class="bg-gray-50 rounded-lg p-4 max-h-32 overflow-y-auto">
                <p class="text-gray-400 text-sm">아직 당첨된 기록이 없습니다.</p>
            </div>
        </div>
    </div>

    <script>
        class LotteryGame {
            constructor() {
                this.baseChance = 0.01;
                this.baseCooldown = 3000;
                this.currentCooldown = this.baseCooldown;
                this.drawCount = 0;
                this.winHistory = [];
                this.isOnCooldown = false;
                this.revealedDigits = [];
                this.targetCode = '';
                this.playTimeInterval = null;
                this.startTime = Date.now();
                this.totalCoins = 0;
                
                this.machines = {
                    1: { level: 1, drawCount: 0, active: false, goldenUnlocked: false, rainbowUnlocked: false, cooldownMultiplier: 3 },
                    2: { level: 1, drawCount: 0, active: false, goldenUnlocked: false, rainbowUnlocked: false, cooldownMultiplier: 2.5 },
                    3: { level: 1, drawCount: 0, active: false, goldenUnlocked: false, rainbowUnlocked: false, cooldownMultiplier: 2 },
                    4: { level: 1, drawCount: 0, active: false, goldenUnlocked: false, rainbowUnlocked: false, cooldownMultiplier: 1.8 },
                    5: { level: 1, drawCount: 0, active: false, goldenUnlocked: false, rainbowUnlocked: false, cooldownMultiplier: 1.5 }
                };
                this.levelCosts = [10, 20, 50, 100];
                this.goldenCost = 500;
                this.rainbowCost = 1000;
                
                this.initializeElements();
                this.updateTodayCode();
                this.updateDisplay();
                this.bindEvents();
                this.startPlayTimer();
            }

            initializeElements() {
                this.mainProgressBar = document.getElementById('mainProgressBar');
                this.playTimeEl = document.getElementById('playTime');
                this.currentProgressEl = document.getElementById('currentProgress');
                this.currentChanceEl = document.getElementById('currentChance');
                this.cooldownTimeEl = document.getElementById('cooldownTime');
                this.drawCountEl = document.getElementById('drawCount');
                this.drawButton = document.getElementById('drawButton');
                this.buttonStatus = document.getElementById('buttonStatus');
                this.resultArea = document.getElementById('resultArea');
                this.winHistoryEl = document.getElementById('winHistory');
                this.pendantMessageEl = document.getElementById('pendantMessage');
                this.totalCoinsEl = document.getElementById('totalCoins');
                this.coinsPopupContainer = document.getElementById('coinsPopupContainer');
                this.toggleAllAutoMachinesButton = document.getElementById('toggleAllAutoMachines');
                
                this.machineElements = {};
                for (let i = 1; i <= 5; i++) {
                    this.machineElements[i] = {
                        wrapper: document.getElementById(`autoMachine${i}Wrapper`),
                        statusEl: document.getElementById(`autoStatus${i}`),
                        progressEl: document.getElementById(`autoProgress${i}`),
                        levelEl: document.getElementById(`autoLevel${i}`),
                        chanceEl: document.getElementById(`autoChance${i}`),
                        drawCountEl: document.getElementById(`autoDrawCount${i}`),
                        levelUpBtn: document.getElementById(`levelUpAuto${i}`),
                        unlockGoldenBtn: document.getElementById(`unlockGolden${i}`),
                        unlockRainbowBtn: document.getElementById(`unlockRainbow${i}`),
                    };
                }
            }
            
            startPlayTimer() {
                this.playTimeInterval = setInterval(() => {
                    const elapsed = Date.now() - this.startTime;
                    const minutes = Math.floor(elapsed / 60000);
                    const seconds = Math.floor((elapsed % 60000) / 1000);
                    if(this.playTimeEl) this.playTimeEl.textContent = `${minutes}분 ${seconds}초`;
                }, 1000);
            }

            updateTodayCode() {
                const today = new Date();
                const year = today.getFullYear();
                const month = today.getMonth() + 1;
                const day = today.getDate();
                const code = year * month * day;
                this.targetCode = code.toString().slice(0, 5);
                this.updateProgressDisplay();
            }

            updateProgressDisplay() {
                let display = '';
                for (let i = 0; i < this.targetCode.length; i++) {
                    if (this.revealedDigits.includes(i)) {
                        display += this.targetCode[i];
                    } else {
                        display += '?';
                    }
                }
                if (this.currentProgressEl) this.currentProgressEl.textContent = display || '?????';
            }

            getChance(drawCount) {
                const bonusChance = Math.floor(drawCount / 10) * 0.01;
                return this.baseChance + bonusChance;
            }
            
            getSpecialDrawChance() {
                let chanceMultiplier = 1;
                if (this.drawCount > 0 && this.drawCount % 15 === 0) {
                    chanceMultiplier = 2;
                }
                if (this.drawCount > 0 && this.drawCount % 50 === 0) {
                    chanceMultiplier = 5;
                }
                return (this.getChance(this.drawCount) * chanceMultiplier);
            }
            
            getAutoMachineChance(machineNumber) {
                const machine = this.machines[machineNumber];
                const bonusChancePer5 = 0.01 + (machine.level - 1) * 0.002;
                const bonusChance = Math.floor(machine.drawCount / 5) * bonusChancePer5;
                let chance = this.baseChance + bonusChance;
                let chanceMultiplier = 1;
                if (machine.goldenUnlocked && machine.drawCount > 0 && machine.drawCount % 8 === 0) {
                    chanceMultiplier *= 2;
                }
                if (machine.rainbowUnlocked && machine.drawCount > 0 && machine.drawCount % 20 === 0) {
                    chanceMultiplier *= 5;
                }
                
                return chance * chanceMultiplier;
            }
            
            updateCurrentCooldown() {
                const newCooldown = this.currentCooldown * 0.99;
                this.currentCooldown = Math.max(800, newCooldown);
            }

            getCoinsGained(level) {
                if (level === 1) return Math.floor(Math.random() * 3) + 1;
                if (level === 2) return Math.floor(Math.random() * 3) + 2;
                if (level === 3) return Math.floor(Math.random() * 3) + 3;
                if (level === 4) return Math.floor(Math.random() * 3) + 4;
                if (level === 5) return Math.floor(Math.random() * 3) + 5;
                return 1;
            }

            updateDisplay() {
                if (this.cooldownTimeEl) this.cooldownTimeEl.textContent = (this.currentCooldown / 1000).toFixed(2) + '초';
                if (this.drawCountEl) this.drawCountEl.textContent = this.drawCount.toString();
                if (this.totalCoinsEl) this.totalCoinsEl.textContent = this.totalCoins.toString();
                if (this.currentChanceEl) this.currentChanceEl.textContent = this.getSpecialDrawChance().toFixed(3) + '%';
                this.drawButton.className = 'text-white font-bold py-4 px-8 rounded-full text-xl shadow-lg transform transition-all duration-200 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none';
                const isRainbowManual = this.drawCount > 0 && this.drawCount % 50 === 0;
                const isGoldenManual = this.drawCount > 0 && this.drawCount % 15 === 0;
                if (isRainbowManual) {
                    this.drawButton.classList.add('rainbow-btn');
                    this.drawButton.textContent = '🌈 무지개 뽑기!';
                    this.currentChanceEl.classList.add('rainbow-text');
                } else if (isGoldenManual) {
                    this.drawButton.classList.add('golden-btn');
                    this.drawButton.textContent = '✨ 황금 뽑기!';
                    this.currentChanceEl.classList.remove('rainbow-text');
                } else {
                    this.drawButton.classList.add('bg-gradient-to-r', 'from-pink-500', 'to-purple-600', 'hover:from-pink-600', 'hover:to-purple-700');
                    this.drawButton.textContent = '🎲 뽑기!';
                    this.currentChanceEl.classList.remove('rainbow-text');
                }

                if (this.drawCount >= 10 && !this.machines[1].active) this.activateAutoMachine(1);
                if (this.machines[1].drawCount >= 20 && !this.machines[2].active) this.activateAutoMachine(2);
                if (this.machines[2].drawCount >= 30 && !this.machines[3].active) this.activateAutoMachine(3);
                if (this.machines[3].drawCount >= 50 && !this.machines[4].active) this.activateAutoMachine(4);
                
                const isMachine5Unlockable = this.drawCount >= 50 && this.machines[1].level >= 4 && this.machines[2].level >= 4 && this.machines[3].level >= 4 && this.machines[4].level >= 4;
                if (isMachine5Unlockable && !this.machines[5].active) this.activateAutoMachine(5);
                
                if (this.mainProgressBar) {
                    const progressPercentage = (this.revealedDigits.length / this.targetCode.length) * 100;
                    this.mainProgressBar.style.width = `${progressPercentage}%`;
                }
                
                this.updateMachineUpgrades();
            }

            updateMachineUpgrades() {
                for (let i = 1; i <= 5; i++) {
                    const machine = this.machines[i];
                    const elements = this.machineElements[i];

                    if (elements && elements.wrapper && !elements.wrapper.classList.contains('hidden')) {
                        if (elements.levelEl) elements.levelEl.textContent = machine.level;
                        if (elements.chanceEl) elements.chanceEl.textContent = this.getAutoMachineChance(i).toFixed(3) + '%';
                        if (elements.drawCountEl) elements.drawCountEl.textContent = machine.drawCount;
                        
                        const nextLevelCost = this.levelCosts[machine.level - 1];
                        if (machine.level < 5) {
                            if (elements.levelUpBtn) {
                                elements.levelUpBtn.textContent = `레벨업 (${nextLevelCost} 코인)`;
                                elements.levelUpBtn.disabled = this.totalCoins < nextLevelCost;
                                elements.levelUpBtn.classList.remove('hidden');
                            }
                        } else {
                            if (elements.levelUpBtn) elements.levelUpBtn.classList.add('hidden');
                        }
                        
                        if (machine.level >= 5 && !machine.goldenUnlocked) {
                            if (elements.unlockGoldenBtn) {
                                elements.unlockGoldenBtn.classList.remove('hidden');
                                elements.unlockGoldenBtn.disabled = this.totalCoins < this.goldenCost;
                            }
                        } else if (machine.goldenUnlocked) {
                            if (elements.unlockGoldenBtn) {
                                elements.unlockGoldenBtn.classList.remove('hidden');
                                elements.unlockGoldenBtn.textContent = '황금 뽑기 잠금 해제됨';
                                elements.unlockGoldenBtn.disabled = true;
                            }
                        } else {
                            if (elements.unlockGoldenBtn) elements.unlockGoldenBtn.classList.add('hidden');
                        }

                        if (machine.goldenUnlocked && !machine.rainbowUnlocked) {
                            if (elements.unlockRainbowBtn) {
                                elements.unlockRainbowBtn.classList.remove('hidden');
                                elements.unlockRainbowBtn.disabled = this.totalCoins < this.rainbowCost;
                            }
                        } else if (machine.rainbowUnlocked) {
                            if (elements.unlockRainbowBtn) {
                                elements.unlockRainbowBtn.classList.remove('hidden');
                                elements.unlockRainbowBtn.textContent = '무지개 뽑기 잠금 해제됨';
                                elements.unlockRainbowBtn.disabled = true;
                            }
                        } else {
                            if (elements.unlockRainbowBtn) elements.unlockRainbowBtn.classList.add('hidden');
                        }
                    }
                }
            }
            
            checkAllUpgradesComplete() {
                for (let i = 1; i <= 5; i++) {
                    const machine = this.machines[i];
                    if (machine.level < 5 || !machine.goldenUnlocked || !machine.rainbowUnlocked) {
                        return false;
                    }
                }
                return true;
            }

            bindEvents() {
                if (this.drawButton) this.drawButton.addEventListener('click', () => this.draw());
                if (this.toggleAllAutoMachinesButton) this.toggleAllAutoMachinesButton.addEventListener('click', () => this.toggleAllMachines());
                
                for (let i = 1; i <= 5; i++) {
                    const elements = this.machineElements[i];
                    if (elements.levelUpBtn) elements.levelUpBtn.addEventListener('click', () => this.levelUp(i));
                    if (elements.unlockGoldenBtn) elements.unlockGoldenBtn.addEventListener('click', () => this.unlockGoldenDraw(i));
                    if (elements.unlockRainbowBtn) elements.unlockRainbowBtn.addEventListener('click', () => this.unlockRainbowDraw(i));
                }
            }

            levelUp(machineNumber) {
                const machine = this.machines[machineNumber];
                const cost = this.levelCosts[machine.level - 1];
                if (this.totalCoins >= cost && machine.level < 5) {
                    this.totalCoins -= cost;
                    machine.level++;
                    this.updateDisplay();
                }
            }

            unlockGoldenDraw(machineNumber) {
                const machine = this.machines[machineNumber];
                if (this.totalCoins >= this.goldenCost) {
                    this.totalCoins -= this.goldenCost;
                    machine.goldenUnlocked = true;
                    this.updateDisplay();
                }
            }
            
            unlockRainbowDraw(machineNumber) {
                const machine = this.machines[machineNumber];
                if (this.totalCoins >= this.rainbowCost) {
                    this.totalCoins -= this.rainbowCost;
                    machine.rainbowUnlocked = true;
                    this.updateDisplay();
                }
            }

            draw() {
                if (this.isOnCooldown) return;
                this.drawCount++;
                this.updateCurrentCooldown();
                
                const random = Math.random() * 100;
                const currentChance = this.getSpecialDrawChance();
                const coinsGained = this.getCoinsGained(1);
                this.totalCoins += coinsGained;
                this.showResult(random < currentChance, 0, coinsGained);
                if (random < currentChance) {
                    this.addWinRecord(0);
                }
                
                this.startCooldown();
                this.updateDisplay();
            }

            showCoinPopup(coins) {
                const popup = document.createElement('div');
                popup.textContent = `+${coins} 코인`;
                popup.classList.add('coin-popup');
                if (this.coinsPopupContainer) {
                    this.coinsPopupContainer.appendChild(popup);
                    setTimeout(() => popup.remove(), 1000);
                }
            }

            activateAutoMachine(machineNumber) {
                const wrapper = this.machineElements[machineNumber]?.wrapper;
                if (!wrapper) return;
                
                this.machines[machineNumber].active = true;
                wrapper.classList.remove('hidden');
                this.startAutoMachine(machineNumber);
            }

            startAutoMachine(machineNumber) {
                if (!this.machines[machineNumber].active) return;
                const machine = this.machines[machineNumber];
                const autoCooldown = this.currentCooldown * machine.cooldownMultiplier;
                const elements = this.machineElements[machineNumber];
                const { statusEl, progressEl } = elements;
                let remainingTime = autoCooldown;
                const interval = setInterval(() => {
                    if (!this.machines[machineNumber].active || remainingTime <= 0) {
                        clearInterval(interval);
                        if (!this.machines[machineNumber].active) return;
                        this.performAutoDraw(machineNumber);
                        return;
                    }
                    const progress = ((autoCooldown - remainingTime) / autoCooldown) * 100;
                    if(progressEl) progressEl.style.width = progress + '%';
                    if(statusEl) statusEl.textContent = `${(remainingTime / 1000).toFixed(1)}초 후 자동 뽑기`;
                    remainingTime -= 100;
                }, 100);
            }

            performAutoDraw(machineNumber) {
                const machine = this.machines[machineNumber];
                machine.drawCount++;
                this.updateMachineUpgrades();
                
                const random = Math.random() * 100;
                const autoChance = this.getAutoMachineChance(machineNumber);
                const coinsGained = this.getCoinsGained(machine.level);
                this.totalCoins += coinsGained;
                if (random < autoChance) {
                    this.showResult(true, machineNumber, coinsGained);
                    this.addWinRecord(machineNumber);
                } else {
                    this.showResult(false, machineNumber, coinsGained);
                }
                
                this.startAutoMachine(machineNumber);
            }

            showResult(isCodeWin, machineNumber, coinsGained) {
                if(this.resultArea) this.resultArea.innerHTML = '';
                this.showCoinPopup(coinsGained);
                
                if (isCodeWin) {
                    this.revealNextDigit();
                    const revealedDigit = this.getLastRevealedDigit();
                    let machineText;
                    if (machineNumber === 0) machineText = `일반 뽑기`;
                    else machineText = `자동 ${machineNumber}번 기계`;
                    if(this.resultArea) this.resultArea.innerHTML = `
                        <div class="winner">
                            <p class="text-2xl font-bold text-yellow-600 mb-2">${machineText} 당첨!</p>
                            <p class="text-lg text-green-600">새로운 숫자 공개: <span class="font-bold text-2xl">${revealedDigit}</span></p>
                        </div>
                    `;
                    if(this.resultArea) this.resultArea.classList.add('sparkle');
                    setTimeout(() => { if(this.resultArea) this.resultArea.classList.remove('sparkle'); }, 600);
                    if (this.revealedDigits.length === this.targetCode.length) {
                        setTimeout(() => {
                            if(this.resultArea) this.resultArea.innerHTML += `
                                <div class="mt-4 p-4 bg-green-100 rounded-lg">
                                    <p class="text-xl font-bold text-green-800">🎊 완성! 오늘의 코드를 모두 획득했습니다!</p>
                                    <p class="text-lg text-green-700">완성된 코드: ${this.targetCode}</p>
                                </div>
                            `;
                            clearInterval(this.playTimeInterval);
                        }, 1000);
                    }
                }
            }

            revealNextDigit() {
                const unrevealedPositions = [];
                for (let i = 0; i < this.targetCode.length; i++) {
                    if (!this.revealedDigits.includes(i)) {
                        unrevealedPositions.push(i);
                    }
                }
                
                if (unrevealedPositions.length > 0) {
                    const randomIndex = Math.floor(Math.random() * unrevealedPositions.length);
                    const positionToReveal = unrevealedPositions[randomIndex];
                    this.revealedDigits.push(positionToReveal);
                    this.updateProgressDisplay();
                }
            }

            getLastRevealedDigit() {
                if (this.revealedDigits.length === 0) return '?';
                const lastPosition = this.revealedDigits[this.revealedDigits.length - 1];
                return this.targetCode[lastPosition];
            }

            startCooldown() {
                this.isOnCooldown = true;
                if(this.drawButton) this.drawButton.disabled = true;
                
                let remainingTime = this.currentCooldown / 1000;
                const updateCooldownDisplay = () => {
                    if (remainingTime > 0) {
                        if(this.buttonStatus) this.buttonStatus.textContent = `재사용까지 ${remainingTime.toFixed(1)}초`;
                        remainingTime -= 0.1;
                        setTimeout(updateCooldownDisplay, 100);
                    } else {
                        this.isOnCooldown = false;
                        if(this.drawButton) this.drawButton.disabled = false;
                        if(this.buttonStatus) this.buttonStatus.textContent = '';
                    }
                };
                updateCooldownDisplay();
            }

            addWinRecord(machineNumber) {
                const now = new Date();
                const timeString = now.toLocaleTimeString('ko-KR');
                
                let drawNumber, isAuto;
                if (machineNumber === 0) {
                    drawNumber = this.drawCount;
                    isAuto = false;
                } else {
                    drawNumber = machineNumber;
                    isAuto = true;
                }
                
                const winRecord = {
                    time: timeString,
                    drawNumber: drawNumber,
                    isAuto: isAuto
                };
                this.winHistory.unshift(winRecord);
                this.updateWinHistory();
            }

            updateWinHistory() {
                if (this.winHistory.length === 0) {
                    if(this.winHistoryEl) this.winHistoryEl.innerHTML = '<p class="text-gray-400 text-sm">아직 당첨된 기록이 없습니다.</p>';
                    return;
                }

                const historyHTML = this.winHistory.map((record, index) => `
                    <div class="flex justify-between items-center py-2 ${index > 0 ? 'border-t border-gray-200' : ''}">
                        <span class="text-sm font-medium ${record.isAuto ? 'text-orange-700' : 'text-gray-700'}">
                            ${record.isAuto ? `🤖 ${record.drawNumber}번 기계` : `${record.drawNumber}번째 일반`}
                        </span>
                        <span class="text-xs text-gray-500">${record.time}</span>
                    </div>
                `).join('');
                if(this.winHistoryEl) this.winHistoryEl.innerHTML = historyHTML;
            }
            
            toggleAllMachines() {
                const wrappers = [this.machineElements[1].wrapper, this.machineElements[2].wrapper, this.machineElements[3].wrapper, this.machineElements[4].wrapper, this.machineElements[5].wrapper];
                let allVisible = true;
                wrappers.forEach(wrapper => {
                    if(wrapper && wrapper.classList.contains('hidden')) {
                        allVisible = false;
                    }
                });
                const shouldHide = allVisible;
                
                wrappers.forEach(wrapper => {
                    if(wrapper) {
                        if (shouldHide) {
                            wrapper.classList.add('hidden');
                        } else if(this.machines[parseInt(wrapper.id.slice(-1))].active){
                            wrapper.classList.remove('hidden');
                        }
                    }
                });
                if (this.toggleAllAutoMachinesButton) {
                    this.toggleAllAutoMachinesButton.textContent = shouldHide ? '자동 기계 보이기' : '자동 기계 숨기기';
                }
            }
        }

        new LotteryGame();
    </script>
</body>
</html>
